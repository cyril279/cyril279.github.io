<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>colorspace</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="picture-colorspace">Picture (colorspace):</h1>
<p>Set up for desktop use or for kodi (video appliance) <a href="https://docs.google.com/document/d/1jG_KH6GXcyeO6PD1BOyckej9w6nhdVJnliWQqq2zDAY/edit#heading=h.graxpyv5qy37">have different approaches</a>.<br>
The colorspace of the display decides whether we are trying to scale to rgb full, or rgb limited.<br>
The Vizio FV551XVT sees a limited spectrum at it’s HDMI ports, so that is what we want to send.</p>
<h2 id="hardware-prep">hardware prep:</h2>
<p>kodi 18 &gt; Denon 1911 &gt; Vizio FV551XVT<br>
TV: turn off the effects &amp; color shaping &amp; stuff. The PC will drive the bus.<br>
AVR: Video Mode: Auto: Process video automatically based on the HDMI content<br>
information. (p.47)</p>
<h2 id="pc">PC:</h2>
<p>For best video playback (appliance setup), your GPU can (and should) be set to output FULL video levels. This sets the gpu to pass through all colorspace data from the player, which avoids unnecessary manipulation of the video levels.</p>
<p>For desktop colorspace to be accurate, the output of the GPU should be set to match the display. This ensures that the colors of all apps will display correctly, but potentially at the cost of overhandling the video levels.</p>
<h3 id="nvidianouveau">(nvidia/nouveau):</h3>
<p>This combination doesn’t seem to respond to xorg.conf.d colorspace entries, so we use the intel method: <strong>&lt;&lt; untested &gt;&gt;</strong><br>
[[ ~/.config/autostart/ ]]<br>
[[ /etc/xdg/autostart ]] all users</p>
<p><a href="https://debian-administration.org/article/50/Running_applications_automatically_when_X_starts">remember to make executable</a></p>
<p><a href="http://set-colorspace.sh">set-colorspace.sh</a></p>
<pre><code>#!/bin/sh
xrandr --output HDMIx --set "Broadcast RGB" "Limited 16:235"
</code></pre>
<pre><code>#!/bin/sh  
xrandr --output HDMIx --set "Broadcast RGB" "Full"
</code></pre>
<p>(replace HDMIx with the appropriate output device, verify by running xrandr).</p>
<p><a href="https://openelec.tv/documentation/configuration/configuring-a-custom-xorg-conf#color-space-2">ref-openelec</a> :: <a href="https://wiki.archlinux.org/index.php/Intel_graphics#Weathered_colors_.28color_range_problem.29">ref-archwiki</a> :: <a href="https://kodi.wiki/view/Video_levels_and_color_space#Changing_Video_Level_Settings">ref-kodiwiki</a> :: <a href="https://docs.google.com/document/d/1jG_KH6GXcyeO6PD1BOyckej9w6nhdVJnliWQqq2zDAY/edit#heading=h.8fmuuqmn0u01">kodi addresses colorspace</a></p>
<h3 id="nvidianvidia">(nvidia/nvidia);</h3>
<ul>
<li><strong>YCC</strong> #looks nice</li>
<li><strong>RGB full</strong> #crushes whites and blacks</li>
<li><strong>RGB limited</strong> #does best against calibration methods</li>
</ul>
<p>/etc/X11/xorg.conf.d/20-nvidia.conf (sets ColorRange specifically for Vizio FV551XVT)</p>
<pre><code>Section "Device"
	Identifier "Device0"
	Driver "nvidia"
	VendorName "NVIDIA Corporation"
	BoardName "GeForce GT 730"
EndSection

Section "Screen"
	Identifier "Screen0"
	Device "Device0"
#	Option "ColorRange" "Full"
	Option "ColorRange" "Limited"
#	Option "ColorSpace" "YCbCr444"
#	Option "ColorSpace" "RGB"
EndSection
</code></pre>
<h1 id="notes">Notes:</h1>
<h2 id="kodi-addresses-colorspace"><a href="https://kodi.wiki/view/Video_levels_and_color_space#Notable_Occurrences">kodi addresses colorspace</a></h2>
<p><strong>kodi gpu display</strong></p>
<p>full &gt; limited &gt; limited</p>
<ul>
<li>kodi transforms ycbcr to rgbv &amp; expands video levels from 16-235 to 0-255</li>
<li>GPU compresses video levels from 0-255 to 16-235</li>
<li>tv displays limited video levels</li>
</ul>
<p><strong>advantage:</strong> correct levels displayed for both player and desktop<br>
<strong>disadvantage:</strong> video levels are scaled twice (banding likely).<br>
^^perhaps why libreelec says <a href="https://openelec.tv/documentation/configuration/configuring-a-custom-xorg-conf#color-space">avoid to set xorg to YCbCr</a></p>
<p><strong>kodi gpu display</strong></p>
<p>limited &gt; full &gt; limited</p>
<ul>
<li>kodi transforms ycbcr to rgb</li>
<li>GPU leaves video untouched, i.e. pass-through</li>
<li>tv displays limited video levels</li>
</ul>
<p><strong>advantage:</strong> color-range preserved, zero scaling<br>
<strong>disadvantage:</strong> incorrect color display via desktop (crushed blacks and whites)</p>
<p>Solution?: To get accurate color display on both kodi and desktop without the extra scaling, allow session (or user?) to set colorspace (no colorspace setting at kernel command-line)</p>
<p>kodi session (user) can use limited &gt; full &gt; limited<br>
desktop session (or other user) can use xorg-set colorspace</p>
<p>test images<br>
<a href="http://www.lagom.nl/lcd-test/">http://www.lagom.nl/lcd-test/</a><br>
<a href="https://ndimitrov.com/wp-content/uploads/2010/07/ndimitrov_calibration_chart.jpg">https://ndimitrov.com/wp-content/uploads/2010/07/ndimitrov_calibration_chart.jpg</a></p>
<p>try/ref:<br>
<a href="https://www.brad-x.com/2017/08/07/quick-tip-setting-the-color-space-value-in-wayland/">https://www.brad-x.com/2017/08/07/quick-tip-setting-the-color-space-value-in-wayland/</a><br>
<a href="https://kodi.wiki/view/Video_levels_and_color_space">https://kodi.wiki/view/Video_levels_and_color_space</a><br>
<a href="https://bugs.freedesktop.org/show_bug.cgi?id=83226">https://bugs.freedesktop.org/show_bug.cgi?id=83226</a></p>
<blockquote>
<p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>
</div>
</body>

</html>
